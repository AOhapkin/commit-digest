#!/bin/bash

# Quick Report Script –¥–ª—è Commit Digest
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç—á–µ—Ç—ã

echo "üöÄ Quick Report Generator"
echo "=========================="

# –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É commit-digest
COMMIT_DIGEST_PATH="$(dirname "$0")/.."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$COMMIT_DIGEST_PATH"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω package.json. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏."
    exit 1
fi

echo "üìÅ –ü–æ–∏—Å–∫ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏..."

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ .git –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
REPOS=$(find ~ -name ".git" -type d 2>/dev/null | head -20)

if [ -z "$REPOS" ]; then
    echo "‚ùå Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    exit 1
fi

echo "üìä –ù–∞–π–¥–µ–Ω–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤: $(echo "$REPOS" | wc -l)"

# –°–æ–∑–¥–∞–µ–º –æ—Ç—á–µ—Ç—ã
echo ""
echo "üîç –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤..."
npm run multi -- --auto --save

echo ""
echo "‚úÖ –û—Ç—á–µ—Ç—ã —Å–æ–∑–¥–∞–Ω—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã weekly-report-*.md" 